<!DOCTYPE html>
<html lang="gl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seguir Contando Contigo - ADOS</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Arial, sans-serif;
      width: 100%;
      padding: 20px;
      background: #fff;
      color: #333;
    }
    h2 {
      color: #c00;
      font-style: italic;
      font-size: clamp(1.1rem, 3vw, 1.6rem);
      margin-bottom: 12px;
    }
    p {
      margin-bottom: 10px;
      line-height: 1.5;
      font-size: clamp(0.9rem, 2vw, 1rem);
    }
    .form-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .form-table td {
      border: 1px solid #aaa;
      padding: 12px;
    }
    label {
      display: block;
      font-size: 14px;
      font-style: italic;
      margin-bottom: 6px;
    }
    input[type="text"], select {
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 3px;
      outline: none;
      font-size: 15px;
      padding: 7px 10px;
      margin-top: 4px;
      background: #fff;
      color: #333;
    }
    input[type="text"]:focus, select:focus {
      border-color: #003087;
      box-shadow: 0 0 0 2px rgba(0,48,135,0.15);
    }
    select:disabled {
      background: #f5f5f5;
      color: #999;
      cursor: not-allowed;
    }
    .pin-wrapper {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .pin-wrapper input {
      width: 160px;
      letter-spacing: 4px;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
    }
    .pin-hint {
      font-size: 12px;
      color: #666;
      font-style: italic;
    }
    button[type="submit"] {
      margin-top: 20px;
      padding: 11px 0;
      background: #003087;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      max-width: 320px;
      display: block;
      transition: background 0.2s;
    }
    button[type="submit"]:hover { background: #004db3; }
    button[type="submit"]:disabled { background: #999; cursor: not-allowed; }
    .msg {
      margin-top: 12px;
      padding: 12px;
      border-radius: 4px;
      display: none;
      font-size: 15px;
    }
    .msg.ok  { background: #d4edda; color: #155724; display: block; }
    .msg.err { background: #f8d7da; color: #721c24; display: block; }
    .token-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      border-radius: 4px;
      padding: 20px;
      margin-top: 20px;
      font-size: 15px;
    }
    .footer-text {
      margin-top: 20px;
      font-style: italic;
      font-weight: bold;
      font-size: 15px;
    }
    .footer-legal {
      font-size: 12px;
      font-style: italic;
      color: #555;
      margin-top: 6px;
    }
  </style>
</head>
<body>

  <h2>¡¡¡QUEREMOS SEGUIR CONTANDO CONTIGO!!!!</h2>

  <p><em>Agradecemos moito a túa participación nas campañas de doazón de sangue e non
  queremos perderte, <strong>ti es imprescindible!!!</strong></em></p>

  <p><em>Indica onde queres seren convocado para as próximas campañas de doazón.</em></p>

  <div id="tokenError" class="token-error" style="display:none;">
    ⚠️ O enlace non é válido ou xa expirou. Se cres que é un erro, contacta con ADOS.
  </div>

  <form id="frmDonante" style="display:none;">
    <table class="form-table">
      <tbody>
        <tr>
          <td>
            <label>Código PIN recibido por SMS:</label>
            <div class="pin-wrapper">
              <input type="text" id="pin" maxlength="6" placeholder="000000"
                     pattern="[0-9]{6}" autocomplete="one-time-code" required />
              <span class="pin-hint">6 díxitos</span>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <label>Provincia:</label>
            <select id="provincia" required>
              <option value="">-- Selecciona provincia --</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <label>Municipio:</label>
            <select id="municipio" disabled required>
              <option value="">-- Primeiro selecciona provincia --</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <label>Lugar de convocatoria:</label>
            <select id="lugar" disabled required>
              <option value="">-- Primeiro selecciona municipio --</option>
            </select>
          </td>
        </tr>
      </tbody>
    </table>

    <button type="submit" id="btnEnviar">Enviar</button>
    <div id="msg" class="msg"></div>
  </form>

  <p class="footer-text">Esperamos seguir contando coa túa solidariedade para axudar a moitos doentes.</p>
  <p class="footer-legal">(Esta información non ten fins comerciais e únicamente forma parte da base de datos dos donantes de ADOS)</p>

<script>
// ── Datos ─────────────────────────────────────────────────────
const PROVINCES      = {"15": "A Coruña", "27": "Lugo", "32": "Ourense", "36": "Pontevedra"};
const MUNICIPALITIES = {"15": [{"id": "001", "name": "Abegondo"}, {"id": "002", "name": "Ames"}, {"id": "003", "name": "Aranga"}, {"id": "004", "name": "Ares"}, {"id": "005", "name": "Arteixo"}, {"id": "006", "name": "Arzúa"}, {"id": "007", "name": "Baña, A"}, {"id": "008", "name": "Bergondo"}, {"id": "009", "name": "Betanzos"}, {"id": "010", "name": "Boimorto"}, {"id": "011", "name": "Boiro"}, {"id": "012", "name": "Boqueixón"}, {"id": "013", "name": "Brión"}, {"id": "014", "name": "Cabana de Bergantiños"}, {"id": "015", "name": "Cabanas"}, {"id": "016", "name": "Camariñas"}, {"id": "017", "name": "Cambre"}, {"id": "018", "name": "Capela, A"}, {"id": "019", "name": "Carballo"}, {"id": "901", "name": "Cariño"}, {"id": "020", "name": "Carnota"}, {"id": "021", "name": "Carral"}, {"id": "022", "name": "Cedeira"}, {"id": "023", "name": "Cee"}, {"id": "024", "name": "Cerceda"}, {"id": "025", "name": "Cerdido"}, {"id": "027", "name": "Coirós"}, {"id": "028", "name": "Corcubión"}, {"id": "029", "name": "Coristanco"}, {"id": "030", "name": "Coruña, A"}, {"id": "031", "name": "Culleredo"}, {"id": "032", "name": "Curtis"}, {"id": "033", "name": "Dodro"}, {"id": "034", "name": "Dumbría"}, {"id": "035", "name": "Fene"}, {"id": "036", "name": "Ferrol"}, {"id": "037", "name": "Fisterra"}, {"id": "038", "name": "Frades"}, {"id": "039", "name": "Irixoa"}, {"id": "041", "name": "Laracha, A"}, {"id": "040", "name": "Laxe"}, {"id": "042", "name": "Lousame"}, {"id": "043", "name": "Malpica de Bergantiños"}, {"id": "044", "name": "Mañón"}, {"id": "045", "name": "Mazaricos"}, {"id": "046", "name": "Melide"}, {"id": "047", "name": "Mesía"}, {"id": "048", "name": "Miño"}, {"id": "049", "name": "Moeche"}, {"id": "050", "name": "Monfero"}, {"id": "051", "name": "Mugardos"}, {"id": "053", "name": "Muros"}, {"id": "052", "name": "Muxía"}, {"id": "054", "name": "Narón"}, {"id": "055", "name": "Neda"}, {"id": "056", "name": "Negreira"}, {"id": "057", "name": "Noia"}, {"id": "058", "name": "Oleiros"}, {"id": "059", "name": "Ordes"}, {"id": "060", "name": "Oroso"}, {"id": "061", "name": "Ortigueira"}, {"id": "062", "name": "Outes"}, {"id": "902", "name": "Oza-Cesuras"}, {"id": "064", "name": "Paderne"}, {"id": "065", "name": "Padrón"}, {"id": "066", "name": "Pino, O"}, {"id": "067", "name": "Pobra do Caramiñal, A"}, {"id": "068", "name": "Ponteceso"}, {"id": "069", "name": "Pontedeume"}, {"id": "070", "name": "Pontes de García Rodríguez, As"}, {"id": "071", "name": "Porto do Son"}, {"id": "072", "name": "Rianxo"}, {"id": "073", "name": "Ribeira"}, {"id": "074", "name": "Rois"}, {"id": "075", "name": "Sada"}, {"id": "076", "name": "San Sadurniño"}, {"id": "077", "name": "Santa Comba"}, {"id": "078", "name": "Santiago de Compostela"}, {"id": "079", "name": "Santiso"}, {"id": "080", "name": "Sobrado"}, {"id": "081", "name": "Somozas, As"}, {"id": "082", "name": "Teo"}, {"id": "083", "name": "Toques"}, {"id": "084", "name": "Tordoia"}, {"id": "085", "name": "Touro"}, {"id": "086", "name": "Trazo"}, {"id": "088", "name": "Val do Dubra"}, {"id": "087", "name": "Valdoviño"}, {"id": "089", "name": "Vedra"}, {"id": "091", "name": "Vilarmaior"}, {"id": "090", "name": "Vilasantar"}, {"id": "092", "name": "Vimianzo"}, {"id": "093", "name": "Zas"}], "27": [{"id": "001", "name": "Abadín"}, {"id": "002", "name": "Alfoz"}, {"id": "003", "name": "Antas de Ulla"}, {"id": "004", "name": "Baleira"}, {"id": "901", "name": "Baralla"}, {"id": "005", "name": "Barreiros"}, {"id": "006", "name": "Becerreá"}, {"id": "007", "name": "Begonte"}, {"id": "008", "name": "Bóveda"}, {"id": "902", "name": "Burela"}, {"id": "009", "name": "Carballedo"}, {"id": "010", "name": "Castro de Rei"}, {"id": "011", "name": "Castroverde"}, {"id": "012", "name": "Cervantes"}, {"id": "013", "name": "Cervo"}, {"id": "016", "name": "Chantada"}, {"id": "014", "name": "Corgo, O"}, {"id": "015", "name": "Cospeito"}, {"id": "017", "name": "Folgoso do Courel"}, {"id": "018", "name": "Fonsagrada, A"}, {"id": "019", "name": "Foz"}, {"id": "020", "name": "Friol"}, {"id": "022", "name": "Guitiriz"}, {"id": "023", "name": "Guntín"}, {"id": "024", "name": "Incio, O"}, {"id": "026", "name": "Láncara"}, {"id": "027", "name": "Lourenzá"}, {"id": "028", "name": "Lugo"}, {"id": "029", "name": "Meira"}, {"id": "030", "name": "Mondoñedo"}, {"id": "031", "name": "Monforte de Lemos"}, {"id": "032", "name": "Monterroso"}, {"id": "033", "name": "Muras"}, {"id": "034", "name": "Navia de Suarna"}, {"id": "035", "name": "Negueira de Muñiz"}, {"id": "037", "name": "Nogais, As"}, {"id": "038", "name": "Ourol"}, {"id": "039", "name": "Outeiro de Rei"}, {"id": "040", "name": "Palas de Rei"}, {"id": "041", "name": "Pantón"}, {"id": "042", "name": "Paradela"}, {"id": "043", "name": "Páramo, O"}, {"id": "044", "name": "Pastoriza, A"}, {"id": "045", "name": "Pedrafita do Cebreiro"}, {"id": "047", "name": "Pobra do Brollón, A"}, {"id": "046", "name": "Pol"}, {"id": "048", "name": "Pontenova, A"}, {"id": "049", "name": "Portomarín"}, {"id": "050", "name": "Quiroga"}, {"id": "056", "name": "Rábade"}, {"id": "051", "name": "Ribadeo"}, {"id": "052", "name": "Ribas de Sil"}, {"id": "053", "name": "Ribeira de Piquín"}, {"id": "054", "name": "Riotorto"}, {"id": "055", "name": "Samos"}, {"id": "057", "name": "Sarria"}, {"id": "058", "name": "Saviñao, O"}, {"id": "059", "name": "Sober"}, {"id": "060", "name": "Taboada"}, {"id": "061", "name": "Trabada"}, {"id": "062", "name": "Triacastela"}, {"id": "063", "name": "Valadouro, O"}, {"id": "064", "name": "Vicedo, O"}, {"id": "065", "name": "Vilalba"}, {"id": "066", "name": "Viveiro"}, {"id": "021", "name": "Xermade"}, {"id": "025", "name": "Xove"}], "32": [{"id": "001", "name": "Allariz"}, {"id": "002", "name": "Amoeiro"}, {"id": "003", "name": "Arnoia, A"}, {"id": "004", "name": "Avión"}, {"id": "005", "name": "Baltar"}, {"id": "006", "name": "Bande"}, {"id": "007", "name": "Baños de Molgas"}, {"id": "008", "name": "Barbadás"}, {"id": "009", "name": "Barco de Valdeorras, O"}, {"id": "010", "name": "Beade"}, {"id": "011", "name": "Beariz"}, {"id": "012", "name": "Blancos, Os"}, {"id": "013", "name": "Boborás"}, {"id": "014", "name": "Bola, A"}, {"id": "015", "name": "Bolo, O"}, {"id": "016", "name": "Calvos de Randín"}, {"id": "018", "name": "Carballeda de Avia"}, {"id": "017", "name": "Carballeda de Valdeorras"}, {"id": "019", "name": "Carballiño, O"}, {"id": "020", "name": "Cartelle"}, {"id": "022", "name": "Castrelo de Miño"}, {"id": "021", "name": "Castrelo do Val"}, {"id": "023", "name": "Castro Caldelas"}, {"id": "024", "name": "Celanova"}, {"id": "025", "name": "Cenlle"}, {"id": "029", "name": "Chandrexa de Queixa"}, {"id": "026", "name": "Coles"}, {"id": "027", "name": "Cortegada"}, {"id": "028", "name": "Cualedro"}, {"id": "030", "name": "Entrimo"}, {"id": "031", "name": "Esgos"}, {"id": "033", "name": "Gomesende"}, {"id": "034", "name": "Gudiña, A"}, {"id": "035", "name": "Irixo, O"}, {"id": "038", "name": "Larouco"}, {"id": "039", "name": "Laza"}, {"id": "040", "name": "Leiro"}, {"id": "041", "name": "Lobeira"}, {"id": "042", "name": "Lobios"}, {"id": "043", "name": "Maceda"}, {"id": "044", "name": "Manzaneda"}, {"id": "045", "name": "Maside"}, {"id": "046", "name": "Melón"}, {"id": "047", "name": "Merca, A"}, {"id": "048", "name": "Mezquita, A"}, {"id": "049", "name": "Montederramo"}, {"id": "050", "name": "Monterrei"}, {"id": "051", "name": "Muíños"}, {"id": "052", "name": "Nogueira de Ramuín"}, {"id": "053", "name": "Oímbra"}, {"id": "054", "name": "Ourense"}, {"id": "055", "name": "Paderne de Allariz"}, {"id": "056", "name": "Padrenda"}, {"id": "057", "name": "Parada de Sil"}, {"id": "058", "name": "Pereiro de Aguiar, O"}, {"id": "059", "name": "Peroxa, A"}, {"id": "060", "name": "Petín"}, {"id": "061", "name": "Piñor"}, {"id": "063", "name": "Pobra de Trives, A"}, {"id": "064", "name": "Pontedeva"}, {"id": "062", "name": "Porqueira"}, {"id": "065", "name": "Punxín"}, {"id": "066", "name": "Quintela de Leirado"}, {"id": "067", "name": "Rairiz de Veiga"}, {"id": "068", "name": "Ramirás"}, {"id": "069", "name": "Ribadavia"}, {"id": "071", "name": "Riós"}, {"id": "072", "name": "Rúa, A"}, {"id": "073", "name": "Rubiá"}, {"id": "074", "name": "San Amaro"}, {"id": "075", "name": "San Cibrao das Viñas"}, {"id": "076", "name": "San Cristovo de Cea"}, {"id": "070", "name": "San Xoán de Río"}, {"id": "077", "name": "Sandiás"}, {"id": "078", "name": "Sarreaus"}, {"id": "079", "name": "Taboadela"}, {"id": "080", "name": "Teixeira, A"}, {"id": "081", "name": "Toén"}, {"id": "082", "name": "Trasmiras"}, {"id": "083", "name": "Veiga, A"}, {"id": "084", "name": "Verea"}, {"id": "085", "name": "Verín"}, {"id": "086", "name": "Viana do Bolo"}, {"id": "087", "name": "Vilamarín"}, {"id": "088", "name": "Vilamartín de Valdeorras"}, {"id": "089", "name": "Vilar de Barrio"}, {"id": "090", "name": "Vilar de Santos"}, {"id": "091", "name": "Vilardevós"}, {"id": "092", "name": "Vilariño de Conso"}, {"id": "032", "name": "Xinzo de Limia"}, {"id": "036", "name": "Xunqueira de Ambía"}, {"id": "037", "name": "Xunqueira de Espadanedo"}], "36": [{"id": "020", "name": "Agolada"}, {"id": "001", "name": "Arbo"}, {"id": "003", "name": "Baiona"}, {"id": "002", "name": "Barro"}, {"id": "004", "name": "Bueu"}, {"id": "005", "name": "Caldas de Reis"}, {"id": "006", "name": "Cambados"}, {"id": "007", "name": "Campo Lameiro"}, {"id": "008", "name": "Cangas"}, {"id": "009", "name": "Cañiza, A"}, {"id": "010", "name": "Catoira"}, {"id": "902", "name": "Cerdedo-Cotobade"}, {"id": "013", "name": "Covelo"}, {"id": "014", "name": "Crecente"}, {"id": "015", "name": "Cuntis"}, {"id": "016", "name": "Dozón"}, {"id": "017", "name": "Estrada, A"}, {"id": "018", "name": "Forcarei"}, {"id": "019", "name": "Fornelos de Montes"}, {"id": "021", "name": "Gondomar"}, {"id": "022", "name": "Grove, O"}, {"id": "023", "name": "Guarda, A"}, {"id": "901", "name": "Illa de Arousa, A"}, {"id": "024", "name": "Lalín"}, {"id": "025", "name": "Lama, A"}, {"id": "026", "name": "Marín"}, {"id": "027", "name": "Meaño"}, {"id": "028", "name": "Meis"}, {"id": "029", "name": "Moaña"}, {"id": "030", "name": "Mondariz"}, {"id": "031", "name": "Mondariz-Balneario"}, {"id": "032", "name": "Moraña"}, {"id": "033", "name": "Mos"}, {"id": "034", "name": "Neves, As"}, {"id": "035", "name": "Nigrán"}, {"id": "036", "name": "Oia"}, {"id": "037", "name": "Pazos de Borbén"}, {"id": "041", "name": "Poio"}, {"id": "043", "name": "Ponte Caldelas"}, {"id": "042", "name": "Ponteareas"}, {"id": "044", "name": "Pontecesures"}, {"id": "038", "name": "Pontevedra"}, {"id": "039", "name": "Porriño, O"}, {"id": "040", "name": "Portas"}, {"id": "045", "name": "Redondela"}, {"id": "046", "name": "Ribadumia"}, {"id": "047", "name": "Rodeiro"}, {"id": "048", "name": "Rosal, O"}, {"id": "049", "name": "Salceda de Caselas"}, {"id": "050", "name": "Salvaterra de Miño"}, {"id": "051", "name": "Sanxenxo"}, {"id": "052", "name": "Silleda"}, {"id": "053", "name": "Soutomaior"}, {"id": "054", "name": "Tomiño"}, {"id": "055", "name": "Tui"}, {"id": "056", "name": "Valga"}, {"id": "057", "name": "Vigo"}, {"id": "059", "name": "Vila de Cruces"}, {"id": "058", "name": "Vilaboa"}, {"id": "060", "name": "Vilagarcía de Arousa"}, {"id": "061", "name": "Vilanova de Arousa"}]};
const COLLECTSITES   = {"15_001": [{"code": "15383", "name": "ABEGONDO"}], "15_002": [{"code": "15084", "name": "BERTAMIRANS (AMES)"}, {"code": "15085", "name": "MILLADOIRO (AMES)"}], "15_003": [{"code": "15486", "name": "ARANGA"}], "15_004": [{"code": "15158", "name": "ARES"}], "15_005": [{"code": "15390", "name": "ARTEIXO"}, {"code": "15389", "name": "PASTORIZA (ARTEIXO)"}, {"code": "15395", "name": "VILLARRODIS"}], "15_006": [{"code": "15639", "name": "ARZUA"}], "15_007": [{"code": "15755", "name": "A BAÑA"}], "15_008": [{"code": "15410", "name": "BERGONDO"}, {"code": "15411", "name": "GUISAMO"}], "15_009": [{"code": "15491", "name": "BETANZOS"}], "15_010": [{"code": "15645", "name": "BOIMORTO"}], "15_011": [{"code": "15840", "name": "BOIRO"}, {"code": "15843", "name": "CABO DE CRUZ"}], "15_012": [{"code": "15093", "name": "FORTE-CAMPORRAPADO"}, {"code": "15094", "name": "LESTEDO"}], "15_013": [{"code": "15099", "name": "BRION"}], "15_014": [{"code": "15536", "name": "CABANA DE BERGANTIÑOS"}], "15_015": [{"code": "15251", "name": "CABANAS"}], "15_016": [{"code": "15681", "name": "CAMARIÑAS"}, {"code": "15683", "name": "CAMELLE (CAMARIÑAS)"}, {"code": "15682", "name": "PONTE DO PORTO (CAMARIÑAS)"}], "15_017": [{"code": "15422", "name": "CAMBRE"}, {"code": "15421", "name": "O TEMPLE"}, {"code": "15424", "name": "URB. LA BARCALA"}], "15_018": [{"code": "15255", "name": "A CAPELA"}], "15_019": [{"code": "15544", "name": "CARBALLO"}], "15_020": [{"code": "15767", "name": "CARNOTA"}], "15_021": [{"code": "15431", "name": "CARRAL"}], "15_022": [{"code": "15164", "name": "CEDEIRA"}], "15_023": [{"code": "15706", "name": "CEE"}], "15_024": [{"code": "15589", "name": "A SILVA (CERCEDA)"}, {"code": "15587", "name": "CERCEDA"}], "15_025": [{"code": "15140", "name": "CERDIDO"}], "15_027": [{"code": "15503", "name": "COIROS"}], "15_028": [{"code": "15713", "name": "CORCUBION"}], "15_029": [{"code": "15552", "name": "CORISTANCO"}], "15_030": [{"code": "15314", "name": "Bº CUATRO CAMINOS"}, {"code": "15270", "name": "Bº DAS CONCHIÑAS"}, {"code": "15308", "name": "Bº DE LAS FLORES"}, {"code": "15307", "name": "Bº ELVIÑA"}, {"code": "15311", "name": "Bº GAITEIRA/OS CASTROS (A CORUÑA)"}, {"code": "15319", "name": "Bº JUAN FLOREZ - PRAZA DE VIGO"}, {"code": "15309", "name": "Bº LABAÑOU"}, {"code": "15354", "name": "Bº LOS ROSALES (A CORUÑA)"}, {"code": "15317", "name": "Bº MONELOS / CASTRILLON"}, {"code": "15323", "name": "Bº MONTE ALTO"}, {"code": "15365", "name": "Bº NOVO MESOIRO (A CORUÑA)"}, {"code": "15321", "name": "Bº OS MALLOS"}, {"code": "15328", "name": "Bº PERULEIRO"}, {"code": "15320", "name": "Bº RIAZOR"}, {"code": "15318", "name": "Bº SAGRADA FAMILIA"}, {"code": "15322", "name": "Bº VENTORRILLO"}, {"code": "15327", "name": "Bº VILLA NEGREIRA"}, {"code": "15272", "name": "CANTON - OBELISCO"}, {"code": "15299", "name": "FACENDA"}, {"code": "15380", "name": "MARINEDA CITY"}, {"code": "15341", "name": "PARQUE STA. MARGARITA-A CORUÑA"}, {"code": "15334", "name": "URB. MATOGRANDE"}], "15_031": [{"code": "15436", "name": "CULLEREDO"}, {"code": "15439", "name": "FONTECULLER"}, {"code": "15438", "name": "O BURGO (CULLEREDO)"}, {"code": "15444", "name": "VILABOA"}], "15_032": [{"code": "15507", "name": "CURTIS"}, {"code": "15508", "name": "TEIXEIRO (CURTIS)"}], "15_035": [{"code": "15171", "name": "Bº SAN VALENTIN (FENE)"}, {"code": "15168", "name": "FENE"}, {"code": "15173", "name": "PERLIO (FENE)"}], "15_036": [{"code": "15191", "name": "Bº CARANZA"}, {"code": "15195", "name": "Bº INFERNIÑO (FERROL)"}, {"code": "15190", "name": "Bº PRAZA DE ARMAS"}, {"code": "15178", "name": "Bº PRAZA DE ESPAÑA"}, {"code": "15200", "name": "Bº ULTRAMAR"}], "15_037": [{"code": "15726", "name": "FISTERRA"}], "15_038": [{"code": "15596", "name": "FRADES"}], "15_039": [{"code": "15513", "name": "IRIXOA"}], "15_040": [{"code": "15567", "name": "LAXE"}], "15_041": [{"code": "15560", "name": "A LARACHA"}, {"code": "15562", "name": "CAION (LARACHA)"}, {"code": "15561", "name": "PAIOSACO (LARACHA)"}], "15_042": [{"code": "15789", "name": "LOUSAME"}], "15_043": [{"code": "15572", "name": "BUÑO (MALPICA)"}, {"code": "15573", "name": "MALPICA DE BERGANTIÑOS"}], "15_044": [{"code": "15144", "name": "MAÑON-O BARQUEIRO"}], "15_045": [{"code": "15737", "name": "A PICOTA (MAZARICOS)"}], "15_046": [{"code": "15663", "name": "MELIDE"}], "15_047": [{"code": "15600", "name": "MESIA"}, {"code": "15601", "name": "XANCEDA (MESIA)"}], "15_048": [{"code": "15518", "name": "MIÑO"}], "15_049": [{"code": "15209", "name": "MOECHE"}], "15_050": [{"code": "15260", "name": "MONFERO"}], "15_051": [{"code": "15213", "name": "MUGARDOS"}], "15_052": [{"code": "15731", "name": "MUXIA"}], "15_053": [{"code": "15779", "name": "ESTEIRO"}, {"code": "15776", "name": "MUROS"}], "15_054": [{"code": "15223", "name": "Bº A GANDARA (NARON)"}, {"code": "15214", "name": "Bº DE XUBIA (NARON)"}, {"code": "15218", "name": "NARON"}, {"code": "15221", "name": "O VAL (NARON)"}], "15_055": [{"code": "15228", "name": "NEDA"}], "15_056": [{"code": "15762", "name": "NEGREIRA"}], "15_057": [{"code": "15795", "name": "NOIA"}], "15_058": [{"code": "15457", "name": "MERA (OLEIROS)"}, {"code": "15455", "name": "OLEIROS"}, {"code": "15467", "name": "PERILLO (OLEIROS)"}, {"code": "15456", "name": "SANTA CRISTINA (OLEIROS)"}, {"code": "15458", "name": "SANTA CRUZ"}], "15_059": [{"code": "15611", "name": "ORDES"}], "15_060": [{"code": "15625", "name": "SIGÜEIRO (OROSO)"}], "15_061": [{"code": "15150", "name": "ORTIGUEIRA"}], "15_062": [{"code": "15803", "name": "SERRA DE OUTES"}], "15_064": [{"code": "15527", "name": "SAN PANTALEON (PADERNDE)"}], "15_065": [{"code": "15828", "name": "PADRON"}], "15_066": [{"code": "15650", "name": "O PINO"}], "15_067": [{"code": "15857", "name": "POBRA CARAMIÑAL"}], "15_068": [{"code": "15578", "name": "CORME (PONTECESO)"}, {"code": "15579", "name": "PONTECESO"}], "15_069": [{"code": "15264", "name": "PONTEDEUME"}], "15_070": [{"code": "15243", "name": "AS PONTES"}], "15_071": [{"code": "15813", "name": "PORTO DO SON"}, {"code": "15814", "name": "PORTOSIN"}, {"code": "15815", "name": "XUÑO"}], "15_072": [{"code": "15867", "name": "RIANXO"}, {"code": "15866", "name": "TARAGOÑA"}], "15_073": [{"code": "15879", "name": "AGUIÑO (RIBEIRA)"}, {"code": "15876", "name": "PALMEIRA (RIBEIRA)"}, {"code": "15873", "name": "RIBEIRA"}], "15_074": [{"code": "15834", "name": "ROIS"}], "15_075": [{"code": "15477", "name": "SADA"}], "15_076": [{"code": "15230", "name": "SAN SADURNIÑO"}], "15_077": [{"code": "15747", "name": "SANTA COMBA"}], "15_078": [{"code": "15039", "name": "ALAMEDA (SANTIAGO)"}, {"code": "15035", "name": "AREA CENTRAL FONTIÑAS"}, {"code": "15040", "name": "Bº PRAZA ROJA (SANTIAGO)"}, {"code": "15074", "name": "C.C. AS CANCELAS"}, {"code": "15059", "name": "LAVACOLLA"}], "15_080": [{"code": "15672", "name": "SOBRADO"}], "15_081": [{"code": "15234", "name": "AS SOMOZAS"}], "15_082": [{"code": "15109", "name": "CACHEIRAS (TEO)"}, {"code": "15111", "name": "CALO (TEO)"}], "15_084": [{"code": "15630", "name": "TORDOIA"}], "15_085": [{"code": "15654", "name": "TOURO"}], "15_086": [{"code": "15635", "name": "TRAZO"}], "15_087": [{"code": "15240", "name": "MEIRAS"}, {"code": "15239", "name": "VALDOVIÑO"}], "15_088": [{"code": "15120", "name": "BEMBIBRE (VAL DO DUBRA)"}], "15_089": [{"code": "15129", "name": "SANTA CRUZ RIBADULLA"}], "15_090": [{"code": "15659", "name": "VILASANTAR"}], "15_091": [{"code": "15531", "name": "VILARMAIOR"}], "15_092": [{"code": "15693", "name": "BAIÑAS (VIMIANZO)"}, {"code": "15689", "name": "VIMIANZO"}], "15_093": [{"code": "15700", "name": "BAIO (ZAS)"}, {"code": "15699", "name": "ZAS"}], "15_901": [{"code": "15135", "name": "CARIÑO"}], "15_902": [{"code": "15522", "name": "OZA DOS RIOS"}], "27_001": [{"code": "27114", "name": "ABADIN"}], "27_002": [{"code": "27056", "name": "ALFOZ"}], "27_003": [{"code": "27260", "name": "ANTAS DE ULLA"}], "27_005": [{"code": "27092", "name": "SAN COSME DE BARREIROS"}], "27_006": [{"code": "27320", "name": "BECERREA"}], "27_010": [{"code": "27126", "name": "CASTRO RIBERAS DE LEA"}], "27_013": [{"code": "27014", "name": "CERVO"}, {"code": "27016", "name": "SAN CIBRAO (CERVO)"}], "27_015": [{"code": "27133", "name": "MUIMENTA"}], "27_016": [{"code": "27350", "name": "CHANTADA"}], "27_018": [{"code": "27185", "name": "A FONSAGRADA"}], "27_019": [{"code": "27066", "name": "FOZ"}], "27_020": [{"code": "27195", "name": "FRIOL"}], "27_021": [{"code": "27156", "name": "XERMADE"}], "27_022": [{"code": "27138", "name": "GUITIRIZ"}], "27_025": [{"code": "27051", "name": "XOVE"}], "27_026": [{"code": "27278", "name": "LANCARA"}], "27_027": [{"code": "27074", "name": "LOURENZA"}], "27_028": [{"code": "27216", "name": "Bº A MILAGROSA"}, {"code": "27215", "name": "Bº A PIRINGALLA"}, {"code": "27235", "name": "Bº AUGAS FERREAS"}, {"code": "27228", "name": "Bº PARQUE CASTIÑEIRO (LUGO)"}, {"code": "27237", "name": "Bº PRAZA HORTA DO SEMINARIO"}, {"code": "27204", "name": "Bº PRAZA MAIOR"}, {"code": "27225", "name": "RONDA DAS FONTIÑAS - LUGO"}], "27_029": [{"code": "27162", "name": "MEIRA"}], "27_030": [{"code": "27078", "name": "MONDOÑEDO"}], "27_031": [{"code": "27366", "name": "MONFORTE"}], "27_032": [{"code": "27264", "name": "MONTERROSO"}], "27_039": [{"code": "27243", "name": "OUTEIRO DE REI"}], "27_040": [{"code": "27269", "name": "PALAS DE REI"}], "27_041": [{"code": "27380", "name": "FERREIRA DE PANTON"}], "27_044": [{"code": "27108", "name": "A PASTORIZA"}], "27_048": [{"code": "27087", "name": "A PONTENOVA"}], "27_049": [{"code": "27249", "name": "PORTOMARIN"}], "27_050": [{"code": "27398", "name": "QUIROGA"}], "27_051": [{"code": "27098", "name": "RIBADEO"}], "27_056": [{"code": "27254", "name": "RABADE"}], "27_057": [{"code": "27296", "name": "SARRIA"}], "27_058": [{"code": "27375", "name": "O SAVIÑAO"}], "27_060": [{"code": "27354", "name": "TABOADA"}], "27_063": [{"code": "27083", "name": "O VALADOURO"}], "27_065": [{"code": "27149", "name": "VILALBA"}], "27_066": [{"code": "27036", "name": "VIVEIRO"}], "27_901": [{"code": "27315", "name": "BARALLA"}], "27_902": [{"code": "27060", "name": "BURELA"}], "32_001": [{"code": "32392", "name": "ALLARIZ"}], "32_003": [{"code": "32290", "name": "ARNOIA"}], "32_004": [{"code": "32296", "name": "AVION"}], "32_006": [{"code": "32416", "name": "BANDE"}], "32_008": [{"code": "32065", "name": "A VALENZA (BARBADAS)"}], "32_009": [{"code": "32258", "name": "O BARCO DE VALDEORRAS"}], "32_019": [{"code": "32027", "name": "O CARBALLIÑO"}], "32_020": [{"code": "32354", "name": "CARTELLE"}], "32_023": [{"code": "32209", "name": "CASTRO CALDELAS"}], "32_024": [{"code": "32360", "name": "CELANOVA"}], "32_027": [{"code": "32318", "name": "CORTEGADA"}], "32_032": [{"code": "32483", "name": "XINZO DE LIMIA"}], "32_034": [{"code": "32530", "name": "A GUDIÑA"}], "32_036": [{"code": "32407", "name": "XUNQUEIRA DE AMBIA"}], "32_037": [{"code": "32411", "name": "XUNQUEIRA DE ESPADANEDO"}], "32_039": [{"code": "32498", "name": "LAZA"}], "32_042": [{"code": "32429", "name": "LOBIOS"}], "32_043": [{"code": "32402", "name": "MACEDA"}], "32_045": [{"code": "32020", "name": "MASIDE"}], "32_046": [{"code": "32327", "name": "MELON"}], "32_047": [{"code": "32350", "name": "A MERCA"}], "32_048": [{"code": "32536", "name": "A MEZQUITA"}], "32_054": [{"code": "32108", "name": "AVDA. BUENOS AIRES"}, {"code": "32100", "name": "Bº A CARBALLEIRA"}, {"code": "32141", "name": "Bº DA CRUZ ALTA"}, {"code": "32083", "name": "Bº DE BARROCÁS (OURENSE)"}, {"code": "32121", "name": "Bº DO VINTEÚN"}, {"code": "32110", "name": "Bº ESTACION"}, {"code": "32105", "name": "Bº MARIÑAMANSA (OURENSE)"}, {"code": "32092", "name": "Bº O COUTO"}, {"code": "32099", "name": "Bº O POSIO"}, {"code": "32112", "name": "Bº PRAZA DA MARIÑA"}, {"code": "32084", "name": "Bº RUA DO PASEO - OURENSE"}, {"code": "32111", "name": "Bº SAN FRANCISCO"}, {"code": "32101", "name": "Bº VISTA HERMOSA"}, {"code": "32229", "name": "MANZANEDA"}], "32_056": [{"code": "32374", "name": "PADRENDA"}], "32_058": [{"code": "32162", "name": "PEREIRO AGUIAR"}], "32_059": [{"code": "32056", "name": "A PEROXA"}], "32_063": [{"code": "32227", "name": "POBRA DE TRIVES"}], "32_067": [{"code": "32456", "name": "RAIRIZ DE VEIGA"}], "32_069": [{"code": "32332", "name": "RIBADAVIA"}], "32_072": [{"code": "32270", "name": "A RUA"}], "32_076": [{"code": "32051", "name": "SAN CRISTOVO DE CEA"}], "32_077": [{"code": "32461", "name": "SANDIAS"}], "32_085": [{"code": "32519", "name": "VERIN"}], "32_086": [{"code": "32542", "name": "VIANA DO BOLO"}], "36_001": [{"code": "36656", "name": "ARBO"}], "36_002": [{"code": "36198", "name": "BARRO"}], "36_003": [{"code": "36338", "name": "BAIONA"}], "36_004": [{"code": "36293", "name": "BUEU"}], "36_005": [{"code": "36012", "name": "CALDAS DE REIS"}, {"code": "36049", "name": "CLAVO"}], "36_006": [{"code": "36113", "name": "CAMBADOS"}], "36_007": [{"code": "36207", "name": "CAMPO LAMEIRO"}], "36_008": [{"code": "36300", "name": "CANGAS DO MORRAZO"}], "36_009": [{"code": "36648", "name": "A CAÑIZA"}], "36_010": [{"code": "36023", "name": "CATOIRA"}], "36_013": [{"code": "36666", "name": "COVELO"}], "36_015": [{"code": "36033", "name": "CUNTIS"}], "36_017": [{"code": "36053", "name": "A ESTRADA"}], "36_019": [{"code": "36344", "name": "FORNELOS DE MONTES"}], "36_020": [{"code": "36074", "name": "AGOLADA"}], "36_021": [{"code": "36350", "name": "GONDOMAR"}], "36_022": [{"code": "36134", "name": "O GROVE"}], "36_023": [{"code": "36686", "name": "A GUARDA"}], "36_024": [{"code": "36083", "name": "LALIN"}], "36_026": [{"code": "36314", "name": "MARIN"}], "36_027": [{"code": "36121", "name": "DENA"}, {"code": "36120", "name": "MEAÑO"}], "36_028": [{"code": "36129", "name": "MEIS"}], "36_029": [{"code": "36323", "name": "MOAÑA"}], "36_030": [{"code": "36603", "name": "MONDARIZ"}], "36_032": [{"code": "36018", "name": "MORAÑA"}], "36_033": [{"code": "36367", "name": "GUIZAN"}, {"code": "36360", "name": "TAMEIGA"}], "36_034": [{"code": "36594", "name": "AS NEVES"}], "36_035": [{"code": "36378", "name": "NIGRAN"}], "36_036": [{"code": "36693", "name": "SANTA MARIA DE OIA"}], "36_038": [{"code": "36280", "name": "Bº DA PARDA"}, {"code": "36244", "name": "ZONA DA FERRARÍA"}], "36_039": [{"code": "36393", "name": "PORRIÑO"}], "36_040": [{"code": "36044", "name": "PORTAS"}], "36_041": [{"code": "36219", "name": "COMBARRO"}], "36_042": [{"code": "36617", "name": "PONTEAREAS"}], "36_043": [{"code": "36236", "name": "PONTE  CALDELAS"}], "36_044": [{"code": "36039", "name": "PONTECESURES"}], "36_045": [{"code": "36429", "name": "CHAPELA (REDONDELA)"}, {"code": "36425", "name": "REDONDELA"}], "36_046": [{"code": "36141", "name": "RIBADUMIA"}], "36_047": [{"code": "36090", "name": "RODEIRO"}], "36_048": [{"code": "36701", "name": "O ROSAL"}], "36_049": [{"code": "36443", "name": "SALCEDA CASELAS"}], "36_050": [{"code": "36636", "name": "SALVATERRA DO MIÑO"}], "36_051": [{"code": "36147", "name": "PORTONOVO"}, {"code": "36146", "name": "SANXENXO"}, {"code": "36152", "name": "VILALONGA (SANXENXO)"}], "36_052": [{"code": "36096", "name": "BANDEIRA"}, {"code": "36095", "name": "SILLEDA"}], "36_053": [{"code": "36450", "name": "ARCADE"}], "36_054": [{"code": "36708", "name": "GOIAN (TOMIÑO)"}, {"code": "36707", "name": "TOMIÑO"}], "36_055": [{"code": "36717", "name": "TUI"}], "36_056": [{"code": "36048", "name": "VALGA"}], "36_057": [{"code": "36523", "name": "BEMBRIVE"}, {"code": "36492", "name": "Bº AS TRAVESAS (VIGO)"}, {"code": "36500", "name": "Bº BALAIDOS"}, {"code": "36465", "name": "Bº BOUZAS"}, {"code": "36483", "name": "Bº COIA"}, {"code": "36502", "name": "Bº GARCIA BARBON"}, {"code": "36491", "name": "Bº O CALVARIO"}, {"code": "36573", "name": "Bº RESIDENCIAL NAVIA (VIGO)"}, {"code": "36485", "name": "Bº RUA BARCELONA"}, {"code": "36463", "name": "Bº RUA PRINCIPE"}, {"code": "36506", "name": "Bº RUA VENEZUELA"}, {"code": "36464", "name": "Bº TEIS"}, {"code": "36505", "name": "Bº TORRECEDEIRA"}, {"code": "36497", "name": "Bº TRAVESIA DE VIGO"}, {"code": "36551", "name": "CABRAL (VIGO)"}, {"code": "36561", "name": "PARROQUIA VALLADARES"}], "36_058": [{"code": "36286", "name": "VILABOA"}], "36_059": [{"code": "36102", "name": "VILA DE CRUCES"}], "36_060": [{"code": "36165", "name": "CARRIL"}, {"code": "36162", "name": "VILAGARCIA"}, {"code": "36166", "name": "VILAXOAN"}], "36_061": [{"code": "36182", "name": "VILANOVA DE AROUSA"}], "36_901": [{"code": "36108", "name": "ILLA DE AROUSA"}], "36_902": [{"code": "36212", "name": "TENORIO"}]};

// ── URL Apps Script ───────────────────────────────────────────
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyB7eluad4eHyunMZDpMPxG_ElPygWPX7VR-vCydYEaQ6xZtQGROBfyWxkGdHxVKwDycA/exec';

// ── Token desde la URL ────────────────────────────────────────
const TOKEN = new URLSearchParams(window.location.search).get('t') || null;

// ── Inicialización ────────────────────────────────────────────
function initForm() {
  if (!TOKEN) {
    document.getElementById('tokenError').style.display = 'block';
    return;
  }

  document.getElementById('frmDonante').style.display = 'block';

  const selProvincia = document.getElementById('provincia');
  Object.entries(PROVINCES).forEach(([id, name]) => {
    const opt = document.createElement('option');
    opt.value = id;
    opt.textContent = name;
    selProvincia.appendChild(opt);
  });
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initForm);
} else {
  initForm();
}

// ── Cascada Provincia → Municipio ─────────────────────────────
document.getElementById('provincia').addEventListener('change', function () {
  const selMunicipio = document.getElementById('municipio');
  const selLugar     = document.getElementById('lugar');

  selMunicipio.innerHTML = '<option value="">-- Selecciona municipio --</option>';
  selLugar.innerHTML     = '<option value="">-- Primeiro selecciona municipio --</option>';
  selLugar.disabled      = true;

  const provId = this.value;
  if (!provId) { selMunicipio.disabled = true; return; }

  (MUNICIPALITIES[provId] || []).forEach(m => {
    const opt = document.createElement('option');
    opt.value = m.id;
    opt.textContent = m.name;
    selMunicipio.appendChild(opt);
  });
  selMunicipio.disabled = false;
});

// ── Cascada Municipio → Lugar ─────────────────────────────────
document.getElementById('municipio').addEventListener('change', function () {
  const selLugar = document.getElementById('lugar');
  selLugar.innerHTML = '<option value="">-- Selecciona lugar --</option>';

  const provId = document.getElementById('provincia').value;
  const munId  = this.value;

  if (!munId) { selLugar.disabled = true; return; }

  const sites = COLLECTSITES[`${provId}_${munId}`] || [];

  if (sites.length === 0) {
    selLugar.innerHTML = '<option value="">Sen lugares rexistrados neste municipio</option>';
    selLugar.disabled  = true;
    return;
  }

  sites.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s.code;
    opt.textContent = s.name;
    selLugar.appendChild(opt);
  });
  selLugar.disabled = false;
});

// ── Envío ─────────────────────────────────────────────────────
document.getElementById('frmDonante').addEventListener('submit', function (e) {
  e.preventDefault();

  const msgEl  = document.getElementById('msg');
  const btnEnv = document.getElementById('btnEnviar');
  msgEl.className = 'msg';

  const pin      = document.getElementById('pin').value.trim();
  const provId   = document.getElementById('provincia').value;
  const munId    = document.getElementById('municipio').value;
  const lugarSel = document.getElementById('lugar');
  const lugarCod = lugarSel.value;
  const lugarNom = lugarSel.options[lugarSel.selectedIndex]?.text || '';

  if (!/^[0-9]{6}$/.test(pin)) {
    msgEl.className   = 'msg err';
    msgEl.textContent = '⚠️ O PIN debe ter exactamente 6 díxitos numéricos.';
    return;
  }
  if (!provId || !munId || !lugarCod) {
    msgEl.className   = 'msg err';
    msgEl.textContent = '⚠️ Por favor, selecciona provincia, municipio e lugar de convocatoria.';
    return;
  }

  const muniName = (MUNICIPALITIES[provId] || []).find(m => m.id === munId)?.name || munId;

  btnEnv.disabled    = true;
  btnEnv.textContent = 'Enviando...';

  fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'text/plain' },
    body: JSON.stringify({
      token:       TOKEN,
      pin:         pin,
      provincia:   PROVINCES[provId],
      municipio:   muniName,
      lugarCodigo: lugarCod,
      lugarNome:   lugarNom
    })
  })
  .then(r => r.json())
  .then(data => {
    if (data.status === 'ok') {
      msgEl.className   = 'msg ok';
      msgEl.textContent = '✓ Datos gardados correctamente. Moitas grazas pola túa solidariedade!';
      document.querySelectorAll('#frmDonante input, #frmDonante select, #frmDonante button')
              .forEach(el => el.disabled = true);
    } else {
      throw new Error(data.message || 'Erro descoñecido');
    }
  })
  .catch(() => {
    msgEl.className   = 'msg err';
    msgEl.textContent = '✗ Erro ao enviar os datos. Inténtao de novo ou contacta con ADOS.';
    btnEnv.disabled    = false;
    btnEnv.textContent = 'Enviar';
  });
});
</script>
</body>
</html>
